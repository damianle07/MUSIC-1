import React, { useEffect, useRef, useState } from "react";
const TARGET_SEQUENCE = ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"];

export default function App() {
  const [open, setOpen] = useState(false);
  const bufferRef = useRef<string[]>([]);

  useEffect(() => {
    function handleKeyDown(e: KeyboardEvent) {
      const key = e.key;

      // Only track arrow keys
      if (!TARGET_SEQUENCE.includes(key)) return;

      // Add key to buffer
      bufferRef.current.push(key);

      // Keep only last 4 keys
      if (bufferRef.current.length > TARGET_SEQUENCE.length) {
        bufferRef.current.shift();
      }

      // Check match
      const matched = TARGET_SEQUENCE.every(
        (k, i) => bufferRef.current[i] === k
      );

      if (matched) {
        setOpen(true); // show popup
        bufferRef.current = []; // reset
      }
    }

    // Listen for keys
    window.addEventListener("keydown", handleKeyDown);

    return () => {
      window.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  // Close popup on ESC
  useEffect(() => {
    function handleEsc(e: KeyboardEvent) {
      if (e.key === "Escape") setOpen(false);
    }
    window.addEventListener("keydown", handleEsc);
    return () => window.removeEventListener("keydown", handleEsc);
  }, []);

  return (
    <div style={{ padding: "2rem", fontFamily: "sans-serif" }}>
      <h1>Arrow Combo ‚Üí Popup</h1>
      <p>Press ‚Üë ‚Üì ‚Üê ‚Üí to open the GIF popup. Press Esc to close.</p>

      {open && (
        <div
          style={{
            position: "fixed",
            inset: 0,
            backgroundColor: "rgba(0,0,0,0.6)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
          }}
        >
          <div
            style={{
              background: "white",
              padding: "1rem",
              borderRadius: "12px",
              textAlign: "center",
            }}
          >
            <h2>üéâ You unlocked the GIF!</h2>
            <img
              src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdmpuY3dvYjh2N3o1Y2VtOHl4eG16cDgzMmE5dHB1a3JqZWk5bnEwMSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/MDJ9IbxxvDUQM/giphy.gif        "
              alt="fun gif"
              style={{ maxWidth: "300px", borderRadius: "8px" }}
            />
            <br />
            <button onClick={() => setOpen(false)} style={{ marginTop: "1rem" }}>
              Close
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
